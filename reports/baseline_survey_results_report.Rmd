---
title: "Improving nutrition status for under 5 children in Zambezia and Nampula"
subtitle: "Baseline survey results"
author: 
    - name: Mark Myatt
    - name: Ernest Guevarra
date: '`r Sys.Date()`'
output: 
  html_document:
    toc: true
    toc_depth: 3
    self_contained: true
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  error = FALSE,
  message = FALSE,
  echo = FALSE
)

suppressPackageStartupMessages(source("packages.R"))
for (f in list.files(here::here("R"), full.names = TRUE)) source (f)

targets::tar_load(dplyr::starts_with("baseline"))
```

<style type="text/css">
  body{
  font-size: 12pt;
}
</style>

<br/>

## Demographics - respondent

### By province and overall

```{r demo_respondent, echo = FALSE}
baseline_demo_respondent_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Sex" = 3, "Age (years)" = 1, "Age group" = 9, "Language" = 11, 
      "Civil staus" = 6, "Number of years of formal education" = 1, 
      "Number of years of formal education (grouped)" = 4, "Occupation" = 6
    )
  )
```

### By study group and overall

```{r demo_respondent_study_group, echo = FALSE}
baseline_demo_respondent_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Sex" = 3, "Age (years)" = 1, "Age group" = 9, "Language" = 11, 
      "Civil staus" = 6, "Number of years of formal education" = 1, 
      "Number of years of formal education (grouped)" = 4, "Occupation" = 6
    )
  )
```

<br/>

## Demographics - child

### By province and overall

```{r demo_child, echo = FALSE}
baseline_demo_child_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Sex" = 3, "Age (months)" = 1, "Age group" = 7, 
      "Current breastfeeding status" = 1, "Carer's age at birth" = 10, 
      "Location of birth" = 4, "Mode of delivery" = 1, 
      "Presence of complications" = 1, "Birth weight" = 1
    )
  )
```

### By study group and overall

```{r demo_child_study_group, echo = FALSE}
baseline_demo_child_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Sex" = 3, "Age (months)" = 1, "Age group" = 7, 
      "Current breastfeeding status" = 1, "Carer's age at birth" = 10, 
      "Location of birth" = 4, "Mode of delivery" = 1, 
      "Presence of complications" = 1, "Birth weight" = 1
    )
  )
```

<br/>

## Demographics - spouse

### By province and overall

```{r demo_spouse, echo = FALSE}
baseline_demo_spouse_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Age (years)" = 1, "Age group" = 13, 
      "Number of years of format education" = 1, 
      "Number of years of formal education (grouped)" = 4, 
      "Occupation" = 6, "Lives at home" = 3
    )
  )
```

### By study group and overall

```{r demo_spouse_study_group, echo = FALSE}
baseline_demo_spouse_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Age (years)" = 1, "Age group" = 13, 
      "Number of years of format education" = 1, 
      "Number of years of formal education (grouped)" = 4, 
      "Occupation" = 6, "Lives at home" = 3
    )
  )
```

<br/>

## Household income

### By province and overall

```{r hh_income, echo = FALSE}
baseline_hh_income_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Number of persons living in household" = 1, 
      "Number of under 5 years children living in household" = 1, 
      "Number of pregnant women living in household" = 1, 
      "Monthly household income" = 11, 
      "Source of household income" = 9, 
      "Sufficiency of household income" = 4,
      "Sufficiency of family resource" = 4,
      "Household income against household expenses" = 4
    )
  )
```

### By study group and overall

```{r hh_income_study_group, echo = FALSE}
baseline_hh_income_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Number of persons living in household" = 1, 
      "Number of under 5 years children living in household" = 1, 
      "Number of pregnant women living in household" = 1, 
      "Monthly household income" = 11, 
      "Source of household income" = 9, 
      "Sufficiency of household income" = 4,
      "Sufficiency of family resource" = 4,
      "Household income against household expenses" = 4
    )
  )
```

<br/>

## Household structure

### By province and overall

```{r hh_structure, echo = FALSE}
baseline_hh_structure_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Home ownership" = 3, 
      "Number of rooms in home" = 11, 
      "Number of bedrooms in home" = 9, 
      "Roofing material" = 7, 
      "Flooring material" = 6, 
      "Number of months living in current location" = 1,
      "Number of months living in current location (grouped)" = 14
    )
  )
```

### By study group and overall

```{r hh_structure_study_group, echo = FALSE}
baseline_hh_structure_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Home ownership" = 3, 
      "Number of rooms in home" = 11, 
      "Number of bedrooms in home" = 9, 
      "Roofing material" = 7, 
      "Flooring material" = 6, 
      "Number of months living in current location" = 1,
      "Number of months living in current location (grouped)" = 14
    )
  )
```

<br/>

## Household amenities

### By province and overall

```{r hh_amenities, echo = FALSE}
baseline_hh_amenities_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Communication and information access" = 6, 
      "Amenities" = 3, 
      "Number of mosquito nets owned" = 5, 
      "Fuel used for cooking" = 8, 
      "Location of food preparation" = 4, 
      "Fuel used for lighting" = 6
    )
  )
```

### By study group and overall

```{r hh_amenities_study_group, echo = FALSE}
baseline_hh_amenities_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Communication and information access" = 6, 
      "Amenities" = 3, 
      "Number of mosquito nets owned" = 5, 
      "Fuel used for cooking" = 8, 
      "Location of food preparation" = 4, 
      "Fuel used for lighting" = 6
    )
  )
```

<br/>

## Mode of daily travel

### By province and overall

```{r hh_travel, echo = FALSE}
baseline_hh_travel_province_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Usual mode of travel" = 8,
      "Time to travel to health centre (minutes)" = 1,
      "Mode of travel to health centre" = 8, 
      "Time to travel to local markets (minutes)" = 1, 
      "Mode of travel to local markets" = 8, 
      "Time to travel to primary school (minutes)" = 1, 
      "Mode of travel to primary school" = 8,
      "Time to travel to secondary school (minutes)" = 1, 
      "Mode of travel to secondary school" = 8
    )
  )
```

### By study group and overall

```{r hh_travel_study_group, echo = FALSE}
baseline_hh_travel_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Usual mode of travel" = 8,
      "Time to travel to health centre (minutes)" = 1,
      "Mode of travel to health centre" = 8, 
      "Time to travel to local markets (minutes)" = 1, 
      "Mode of travel to local markets" = 8, 
      "Time to travel to primary school (minutes)" = 1, 
      "Mode of travel to primary school" = 8,
      "Time to travel to secondary school (minutes)" = 1, 
      "Mode of travel to secondary school" = 8
    )
  )
```

<br/>

## Household decision making

### By province and overall

```{r hh_decision, echo = FALSE}
baseline_hh_decision_province_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Marrying age" = 4,
      "Using condoms" = 4,
      "Household responsibilities" = 4, 
      "Family planning" = 4, 
      "Agricultural tasks" = 4, 
      "Household finances" = 4, 
      "Child rearing" = 4,
      "Child discipline" = 4, 
      "Healthcare in pregnancy" = 4,
      "Healthcare for child" = 4
    )
  )
```

### By study group and overall

```{r hh_decision_study_group, echo = FALSE}
baseline_hh_decision_study_group_table_report |>
  subset(
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Variable", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Marrying age" = 4,
      "Using condoms" = 4,
      "Household responsibilities" = 4, 
      "Family planning" = 4, 
      "Agricultural tasks" = 4, 
      "Household finances" = 4, 
      "Child rearing" = 4,
      "Child discipline" = 4, 
      "Healthcare in pregnancy" = 4,
      "Healthcare for child" = 4
    )
  )
```

<br/>

## Child Stunting

```{r child_stunting, echo = FALSE}
child_stunting_province_overall <- baseline_child_anthro_province_table |>
  subset(
    indicator_variable %in% c(
      "hfaz", "global_stunting", "moderate_stunting", "severe_stunting"
    ),
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_stunting_strata <- baseline_child_anthro_strata_table |>
  subset(
    indicator_variable %in% c(
      "hfaz", "global_stunting", "moderate_stunting", "severe_stunting"
    ) &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_stunting_study_group <- baseline_child_anthro_study_group_table |>
  subset(
    indicator_variable %in% c(
      "hfaz", "global_stunting", "moderate_stunting", "severe_stunting"
    ) &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_stunting_province_overall,
  child_stunting_strata,
  child_stunting_study_group
) |>
  (\(x) x[ , c(1, 2, 6, 10, 3, 7, 11, 4, 8, 12, 5, 9, 13)])() |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 3)
      x[ , 5:13] <- round(x[ , 5:13] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 4)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Mean Height-for-Age z-score" = 3, 
      "Global Stunting" = 3, 
      "Moderate Stunting" = 3, 
      "Severe Stunting" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

<br/>

## Child underweight

```{r child_underweight, echo = FALSE}
child_underweight_province_overall <- baseline_child_anthro_province_table |>
  subset(
    indicator_variable %in% c(
      "wfaz", "global_underweight", "moderate_underweight", "severe_underweight"
    ),
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_underweight_strata <- baseline_child_anthro_strata_table |>
  subset(
    indicator_variable %in% c(
      "wfaz", "global_underweight", "moderate_underweight", "severe_underweight"
    ) &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_underweight_study_group <- baseline_child_anthro_study_group_table |>
  subset(
    indicator_variable %in% c(
      "wfaz", "global_underweight", "moderate_underweight", "severe_underweight"
    ) &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_underweight_province_overall,
  child_underweight_strata,
  child_underweight_study_group
) |>
  (\(x) x[ , c(1, 2, 6, 10, 3, 7, 11, 4, 8, 12, 5, 9, 13)])() |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 3)
      x[ , 5:13] <- round(x[ , 5:13] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 4)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Mean Weight-for-Age z-score" = 3, 
      "Global Underweight" = 3, 
      "Moderate Underweight" = 3, 
      "Severe Underweight" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

<br/>

## Child wasting by weight-for-height z-score

```{r child_wasting_whz, echo = FALSE}
child_wasting_province_overall <- baseline_child_anthro_province_table |>
  subset(
    indicator_label %in% c(
      "Weight-for-height z-score", "Child wasting by weight-for-height z-score"
    ),
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_wasting_strata <- baseline_child_anthro_strata_table |>
  subset(
    indicator_label %in% c(
      "Weight-for-height z-score", "Child wasting by weight-for-height z-score"
    ) &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_wasting_study_group <- baseline_child_anthro_study_group_table |>
  subset(
    indicator_label %in% c(
      "Weight-for-height z-score", "Child wasting by weight-for-height z-score"
    ) &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_wasting_province_overall,
  child_wasting_strata,
  child_wasting_study_group
) |>
  (\(x) x[ , c(1, 2, 6, 10, 3, 7, 11, 4, 8, 12, 5, 9, 13)])() |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 3)
      x[ , 5:13] <- round(x[ , 5:13] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 4)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Mean Weight-for-Height z-score" = 3, 
      "Global Wasting" = 3, 
      "Moderate Wasting" = 3, 
      "Severe Wasting" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

<br/>

## Child wasting by mid-upper arm circumference

```{r child_wasting_muac, echo = FALSE}
child_wasting_province_overall <- baseline_child_anthro_province_table |>
  subset(
    indicator_label %in% c(
      "Mid-upper arm circumference (cms)", "Child wasting by mid-upper arm circumference"
    ),
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_wasting_strata <- baseline_child_anthro_strata_table |>
  subset(
    indicator_label %in% c(
      "Mid-upper arm circumference (cms)", "Child wasting by mid-upper arm circumference"
    ) &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_wasting_study_group <- baseline_child_anthro_study_group_table |>
  subset(
    indicator_label %in% c(
      "Mid-upper arm circumference (cms)", "Child wasting by mid-upper arm circumference"
    ) &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_wasting_province_overall,
  child_wasting_strata,
  child_wasting_study_group
) |>
  (\(x) x[ , c(1, 2, 6, 10, 3, 7, 11, 4, 8, 12, 5, 9, 13)])() |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 3)
      x[ , 5:13] <- round(x[ , 5:13] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 4)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Mean Mid-Upper Arm Circumference (cms)" = 3, 
      "Global Wasting" = 3, 
      "Moderate Wasting" = 3, 
      "Severe Wasting" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

<br/>

## Severe wasting by nutritional oedema

```{r child_wasting_oedema, echo = FALSE}
child_oedema_province_overall <- baseline_child_anthro_province_table |>
  subset(
    indicator_label == "Child wasting by oedema",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_oedema_strata <- baseline_child_anthro_strata_table |>
  subset(
    indicator_label == "Child wasting by oedema" &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_oedema_study_group <- baseline_child_anthro_study_group_table |>
  subset(
    indicator_label == "Child wasting by oedema" &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_oedema_province_overall,
  child_oedema_strata,
  child_oedema_study_group
) |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", "Estimate", "95% LCL", "95% UCL"),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = FALSE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Severe wasting by oedema" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

## Infant and young chlid feeding

### Food groups consumed

#### By province and overall

```{r child_food_groups, echo = FALSE}
baseline_iycf_province_table_report |>
  subset(
    !indicator_category %in% c("Mean", "Minimum dietary diversity"),
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -study_group
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Food group", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Zambezia" = 3, "Nampula" = 3, "Overall" = 3),
    bold = TRUE
  )
```

#### By study group and overall

```{r child_food_groups_study_group, echo = FALSE}
baseline_iycf_study_group_table_report |>
  subset(
    !indicator_category %in% c("Mean", "Minimum dietary diversity"),
    select = c(
      -indicator_label, -indicator_set, -indicator, 
      -study_round, -strata
    )
  ) |>
  knitr::kable(
    row.names = FALSE,
    col.names = c("Food group", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(" " = 1, "Control" = 3, "Intervention" = 3, "Overall" = 3),
    bold = TRUE
  )
```

### Minimum dietary diversity

```{r iycf_mdd, echo = FALSE}
mdd_province_overall <- baseline_iycf_province_table |>
  subset(
    indicator_label %in% c("Food groups score", "Minimum dietary diversity"),
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()
 
mdd_strata <- baseline_iycf_strata_table |>
  subset(
    indicator_label %in% c("Food groups score", "Minimum dietary diversity") &
      strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

mdd_study_group <- baseline_iycf_study_group_table |>
  subset(
    indicator_label %in% c("Food groups score", "Minimum dietary diversity") &
      study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()
 
rbind(
  mdd_province_overall, mdd_strata, mdd_study_group
) |>
  (\(x) x[ , c(1, 2, 4, 6, 3, 5, 7)])() |>
  (\(x)
    {
      x[ , 2:4]  <- round(x[ , 2:4], digits = 2)
      x[ , 5:7]  <- round(x[ , 5:7] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 2)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = FALSE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Mean Food Groups Score" = 3,
      "Minimum dietary diversity" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```

### Minimum meal frequency

This indicator cannot be calculated using the baseline data provided by UNICEF Mozambique. Specifically, the dataset provided has information on the frequency of solid or semi-solid feeds by children discretised rather than kept in actual number of feeds as reported by the respondent. The discretisation was also done in such a way that does not match groupings in the indicator definition.

### Minimum adequate diet

This indicator cannot be calculated using the baseline data provided by UNICEF Mozambique. This compound indicator requires information about minimum meal frequency to be calculated. As described above, the dataset provided by UNICEF Mozambique does not allow for the calculation of the minimum meal frequency.

## Period prevalence of childhood illnesses

```{r child_illness, echo = FALSE}
child_ill_province_overall <- baseline_child_ill_province_table |>
  subset(
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x)
   {
     rbind(
       x[3, ],
       x[1:2, ]
     )
   }
  )()

child_ill_strata <- baseline_child_ill_strata_table |>
  subset(
    strata != "Overall",
    select = c(indicator_category, strata, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  )

child_ill_study_group <- baseline_child_ill_study_group_table |>
  subset(
    study_group != "Overall",
    select = c(indicator_category, study_group, estimate, lcl, ucl)
  ) |>
  tidyr::pivot_wider(
    names_from = indicator_category,
    values_from = c(estimate, lcl, ucl),
    names_sep = "_"
  ) |>
  (\(x) { names(x)[1] <- "strata"; x })()

rbind(
  child_ill_province_overall,
  child_ill_strata,
  child_ill_study_group
) |>
  (\(x) x[ , c(1, 2, 5, 8, 3, 6, 9, 4, 7, 10)])() |>
  (\(x)
    {
      x[ , 2:10]  <- round(x[ , 2:10] * 100, digits = 1)
      x
    }
  )() |>
  knitr::kable(
    row.names = FALSE,
    col.names = c(" ", rep(c("Estimate", "95% LCL", "95% UCL"), 3)),
    align = "r"
  ) |>
  kableExtra::kable_paper(
    lightable_options = "striped", full_width = TRUE, font_size = 12
  ) |>
  kableExtra::add_header_above(
    header = c(
      " " = 1, 
      "Diarrhoea" = 3, 
      "Fever" = 3, 
      "Cough" = 3
    ),
    bold = TRUE
  ) |>
  kableExtra::pack_rows(
    index = c(
      "Overall" = 1,
      "Province" = 2,
      "Districts in Zambezia" = 5, 
      "Districts in Nampula" = 4, 
      "Study group" = 2
    )
  )
```



<br/>
<br/>