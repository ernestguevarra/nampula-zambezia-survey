---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Improving Nutrition Status for under 5 children in Zambezia and Nampula project baseline and endline survey data analysis and reporting workflow

<!-- badges: start -->
[![test analysis workflow](https://github.com/katilingban/zambezia-nampula-survey/actions/workflows/test-analysis-workflow.yaml/badge.svg)](https://github.com/katilingban/zambezia-nampula-survey/actions/workflows/test-analysis-workflow.yaml)
<!-- badges: end -->

This repository is a [`docker`](https://www.docker.com/get-started)-containerised, [`{targets}`](https://docs.ropensci.org/targets/)-based, [`{renv}`](https://rstudio.github.io/renv/articles/renv.html)-enabled [`R`](https://cran.r-project.org/) workflow developed for the data management, data analysis, and reporting of the **Improving Nutrition Status for under 5 Children in Zambezia and Nampula project baseline and endline survey**.


## Repository Structure

* `data/` contains intermediate data outputs produced by the workflow including an endline survey codebook describing all variables of the endline survey;
* `R/` contains functions created for use in this workflow;
* `reports/` contains literate code for R Markdown reports generated in the workflow;
* `outputs/` contains compiled reports and figures;
* `auth/` contains credentials for Google service account (see below for more information);
* `docs/` contains archived high frequency data checks reports produced during the implementation of the survey;
* `_targets.R` file defines the steps in this workflow's data management and analysis pipeline.


## Reproducibility

### R package dependencies

This project requires `R 4.2.2 Patched (2022-11-10 r83330)`. This project uses the `{renv}` framework to record R package dependencies and versions. Packages and versions used are recorded in `renv.lock` and code used to manage dependencies is in `renv/` and other files in the root project directory. On starting an R session in the working directory, `run renv::restore()` to install R package dependencies.

### Data management and analysis

This project uses the `{targets}` package to create its data management and analysis pipeline as defined in the `_targets.R` file.

* To execute the data management and processing workflow for baseline and endline survey data, run:

```
targets::tar_make(baseline_data_weighted)
targets::tar_make(endline_data_weighted)
```

The schematic figure below summarizes the steps in the data management and processing workflow:


```{r data_management_workflow, echo = FALSE, message = FALSE, results = 'asis'}
cat(
  "```mermaid",
  targets::tar_mermaid(
    targets_only = TRUE, 
    names = c(baseline_data_weighted, endline_data_weighted)
  ),
  "```",
  sep = "\n"
)
```

* To execute the data analysis workflow for the baseline and endline survey data, run:

```
targets::tar_make(dplyr::starts_with("baseline"))
targets::tar_make(dplyr::starts_with("endline"))
```

The schematic figure below summarizes the steps in the data management and processing workflow:


```{r data_analysis_workflow, echo = FALSE, message = FALSE, results = 'asis'}
cat(
  "```mermaid",
  targets::tar_mermaid(
    targets_only = TRUE, 
    names = c(dplyr::starts_with("baseline"), dplyr::starts_with("endline"))
  ),
  "```",
  sep = "\n"
)
```

## Encryption

This repository uses `git-crypt` to enable transparent encryption and decryption of the `.env` file.

The `.env` file contains:

* variables for accessing the survey data direct from ONA;

* variables for authenticating with Google services account setup for this project;

* variables for `SMTP_PASSWORD` and `EMAIL_RECIPIENTS` which are used for sending the email updates for the high frequency data checks.

Those who would like to reproduce the results of this project will require ability to decrypt the `.env` file

To be able to work on this repository, a potential user/collaborator on this project will need to:

* Create their own **PGP (Pretty Good Privacy) public and private keys**; and,

* Share their public key to the authors and request for it to be added to the repository.

Once added, a collaborator can now decrypt the `.env` file after pulling/cloning the repository by running:

```
git-crypt unlock
```

on the terminal.

## Authors

* Mark Myatt
* Ernest Guevarra

## License
The datasets for both baseline and endline survey (not included in this repository) are owned by **UNICEF Mozambique**. Access to these datasets is restricted. Communicate with **UNICEF Mozambique** to request access to the survey datasets.

The code included in this repository is owned by the authors and is licensed under a [GNU General Public License 3 (GPL-3)](https://opensource.org/licenses/GPL-3.0).

## Feedback

Feedback, bug reports and feature requests are welcome; file issues or seek support [here](https://github.com/katilingban/zambezia-nampula-survey/issues).
